---
title: "Boulder Flood"
author: "Jeff Atkins"
date: "June 22, 2016"
output: html_document
---

```{r import-libraries}
library(raster)
library(rgdal)
source("scripts/functions.R")
```
## Pre- and post-flood  DTM and DSM comparison for Boulder, CO for the 2013 Boulder Flood.
![Orthoimagery of Boulder, CO before 2013 flood](prefloodpic.png)

```{r import-rasters}
# importing pre and post flood  digital surface rasters
pre.dsm <- raster("../NEONdata/Boulder_Flood/BLDR_LeeHill_Pre_Post_Flood/pre-flood/BLDR_pre_DSM/preDSM3.tif")

post.dsm <- raster("../NEONdata/Boulder_Flood/BLDR_LeeHill_Pre_Post_Flood/post-flood/postDSM/postDSM3.tif")

# importing pre and post flood digital terrain models

pre.dtm <- raster("../NEONdata/Boulder_Flood/BLDR_LeeHill_Pre_Post_Flood/pre-flood/BLDR_pre_DTM/preDTM3.tif")

post.dtm <- raster("../NEONdata/Boulder_Flood/BLDR_LeeHill_Pre_Post_Flood/post-flood/postDTM/postDTM3.tif")

```

## Vegetation loss from flooding
```{r get-simple-CHM}
# We want to make simple Canopy Height Models of pre- and post-flooding
post_chm <- post.dsm - post.dtm
# 0 values as NA
post_chm[post_chm == 0] <- NA

pre_chm <- pre.dsm - pre.dtm
# 0 values as NA
pre_chm[pre_chm == 0] <- NA

```

```{r check-pre-post-veg-diff}
# Subtract post- from pre-flooding to evaluate veg loss
chm_diff <- pre_chm - post_chm

# Lots of noise. Let's get rid of it.
chm_diff[chm_diff > -1] <- NA

```

## Plot the changes
```{r plot-diff}
plot(chm_diff,
     col = rev(rainbow(40, start = .6)))
```

```{r dsm-change}
dtm.change <- pre.dtm - post.dtm
dtm.change[ dtm.change >= -0.2] <- NA

# density plot of elevation change
density_plot_from_dtm(dtm.change, "Elevation Change Post-Flood \nBoulder, CO")

plot(pre.dtm,
     col = topo.colors(255),
     main = "Pre-Flood DTM \nBoulder, CO")

# Plotting the change in elevation
plot(dtm.change, 
     zlim = c(-50,0),
          col = heat.colors(10),
     main = "Elevation Change Post-Flood \nBoulder, CO")
dsm.change <- pre.dsm - post.dsm

```

